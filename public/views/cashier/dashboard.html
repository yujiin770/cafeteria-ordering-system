<!DOCTYPE html>
<html>
<head>
    <title>Cashier Dashboard</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body>
    <div class="container mt-4">
        <div class="d-flex justify-content-between">
            <h2>üßæ Cashier Dashboard</h2>
            <a href="/" class="btn btn-secondary">Logout</a>
        </div>
        
        <!-- Menu Grid -->
        <div id="menu-items" class="row mb-4"></div>
        
        <!-- Current Order -->
        <div class="card">
            <div class="card-header d-flex justify-content-between">
                Current Order <span id="item-count">(0 items)</span>
            </div>
            <div class="card-body">
                <div id="order-items" class="mb-3"></div>
                <div class="d-flex justify-content-between">
                    <h4>Total: $<span id="order-total">0.00</span></h4>
                    <button id="place-order" class="btn btn-success" disabled>Place Order</button>
                </div>
                <button id="clear-order" class="btn btn-outline-danger mt-2">Clear Order</button>
            </div>
        </div>
    </div>

    <script src="/socket.io/socket.io.js"></script>
    <script>
        const socket = io();
        let currentOrder = [];
        let menu = [];

        // Load menu
        fetch('/api/menu')
            .then(r => r.json())
            .then(data => {
                menu = data;
                displayMenu();
            });

        function displayMenu() {
            const container = document.getElementById('menu-items');
            menu.forEach(item => {
                const col = document.createElement('div');
                col.className = 'col-md-3 mb-3';
                col.innerHTML = `
                    <div class="card h-100">
                        <div class="card-body text-center">
                            <h5>${item.name}</h5>
                            <h6>$${item.price}</h6>
                            <button class="btn btn-primary w-100" onclick="addToOrder(${item.id})">
                                Add to Order
                            </button>
                        </div>
                    </div>`;
                container.appendChild(col);
            });
        }

        function addToOrder(itemId) {
            const item = menu.find(m => m.id === itemId);
            currentOrder.push({...item, quantity: 1});
            updateOrderDisplay();
        }

        function updateOrderDisplay() {
            const container = document.getElementById('order-items');
            const totalEl = document.getElementById('order-total');
            const countEl = document.getElementById('item-count');
            const placeBtn = document.getElementById('place-order');

            container.innerHTML = currentOrder.map((item, index) => `
                <div class="d-flex justify-content-between align-items-center p-2 border-bottom">
                    <span>${item.name} x${item.quantity}</span>
                    <span>$${item.price}</span>
                    <button class="btn btn-sm btn-outline-danger" onclick="removeFromOrder(${index})">Remove</button>
                </div>
            `).join('');

            const total = currentOrder.reduce((sum, item) => sum + (item.price * item.quantity), 0);
            totalEl.textContent = total.toFixed(2);
            countEl.textContent = `(${currentOrder.length} items)`;
            placeBtn.disabled = currentOrder.length === 0;
        }

        document.getElementById('place-order').onclick = () => {
            const orderData = {
                items: currentOrder,
                total: currentOrder.reduce((sum, item) => sum + (item.price * item.quantity), 0)
            };
            
            socket.emit('placeOrder', orderData);
        };

        document.getElementById('clear-order').onclick = () => {
            currentOrder = [];
            updateOrderDisplay();
        };

        function removeFromOrder(index) {
            currentOrder.splice(index, 1);
            updateOrderDisplay();
        }

        socket.on('orderPlaced', (data) => {
            alert(`‚úÖ Order ${data.orderNumber} placed successfully!`);
            currentOrder = [];
            updateOrderDisplay();
        });

        socket.on('orderError', (msg) => {
            alert('‚ùå ' + msg);
        });
    </script>
</body>
</html>
