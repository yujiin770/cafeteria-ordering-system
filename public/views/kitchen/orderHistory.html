<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Order History | Oh My-Silog</title>
    <!-- Added a browser favicon just in case -->
    <link rel="icon" href="https://cdn-icons-png.flaticon.com/512/1046/1046784.png">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <link rel="stylesheet" href="../../css/kitchen-style.css">
</head>
<body>

    <div id="wrapper">
        <div id="sidebar-overlay"></div>
        <div id="sidebar-placeholder"></div>

        <div id="page-content-wrapper">
            
            <nav class="navbar navbar-kitchen navbar-expand-lg border-bottom">
                <div class="container-fluid">
                    <button class="btn btn-outline-secondary" id="sidebarToggle">
                        <i class="fas fa-bars"></i>
                    </button>
                    
                    <div class="ms-3">
                        <h5 class="mb-0 fw-bold">Order History Log</h5>
                    </div>
                    <div class="ms-auto">
                        <small class="text-muted d-none d-md-block fw-bold" id="date-display">loading...</small>
                    </div>
                </div>
            </nav>

            <div class="container-fluid p-4">
                <div class="row mb-4">
                    <div class="col-12">
                        <div class="filter-card">
                            <div class="row g-3 align-items-center">
                                <div class="col-md-5">
                                    <div class="input-group">
                                        <span class="input-group-text bg-light border-end-0"><i class="fas fa-search text-muted"></i></span>
                                        <input type="text" id="orderSearch" class="form-control border-start-0 ps-0" placeholder="Search Order # or Item Name...">
                                    </div>
                                </div>
                                <div class="col-md-3">
                                    <select id="statusFilter" class="form-select">
                                        <option value="">All Statuses</option>
                                        <option value="completed">Completed</option>
                                        <option value="preparing">Preparing</option>
                                        <option value="pending">Pending</option>
                                        <option value="cancelled">Cancelled</option> 
                                    </select>
                                </div>
                                <div class="col-md-4 text-end">
                                    <button class="btn btn-outline-secondary px-4" id="refreshBtn">
                                        <i class="fas fa-sync-alt me-2"></i> Refresh
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="row">
                    <div class="col-12">
                        <div class="history-card">
                            <div class="table-responsive">
                                <table class="table table-custom mb-0 table-hover">
                                    <thead class="bg-light">
                                        <tr>
                                            <th scope="col">Order #</th>
                                            <th scope="col">Time</th>
                                            <th scope="col">Items Ordered</th>
                                            <th scope="col">Total</th>
                                            <th scope="col">Status</th>
                                        </tr>
                                    </thead>
                                    <tbody id="orderHistoryTableBody">
                                        <tr>
                                            <td colspan="5" class="text-center py-5 text-muted">
                                                <div class="spinner-border text-primary mb-2" role="status"></div>
                                                <div>Loading records...</div>
                                            </td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                            <div id="noOrdersMessage" class="text-center py-5 text-muted" style="display: none;">
                                <i class="fas fa-folder-open fa-3x mb-3 opacity-25"></i>
                                <p>No records found matching your filters.</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="/socket.io/socket.io.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
    
    <script>
        document.addEventListener("DOMContentLoaded", function () {
            // Load Sidebar
            fetch('../partials/_kitchen_sidebar.html')
                .then(response => response.text())
                .then(data => {
                    document.getElementById('sidebar-placeholder').innerHTML = data;
                    
                    // FORCE ACTIVE STATE ON HISTORY
                    const historyLink = document.getElementById('nav-history');
                    if(historyLink) historyLink.classList.add('active');
                });

            // Toggle Logic
            const sidebarToggle = document.getElementById('sidebarToggle');
            const wrapper = document.getElementById('wrapper');
            const overlay = document.getElementById('sidebar-overlay');

            if (sidebarToggle) {
                sidebarToggle.addEventListener('click', (e) => {
                    e.preventDefault();
                    if (window.innerWidth >= 768) {
                        const actualSidebar = document.getElementById('sidebar-wrapper');
                        if(actualSidebar) actualSidebar.classList.toggle('collapsed');
                        wrapper.classList.toggle('toggled');
                    } else {
                        const actualSidebar = document.getElementById('sidebar-wrapper');
                        if(actualSidebar) actualSidebar.classList.toggle('mobile-show');
                        if(overlay) overlay.classList.toggle('active');
                    }
                });
            }

            if (overlay) {
                overlay.addEventListener('click', () => {
                    const actualSidebar = document.getElementById('sidebar-wrapper');
                    if(actualSidebar) actualSidebar.classList.remove('mobile-show');
                    overlay.classList.remove('active');
                });
            }
        });
    </script>
    
    <script src="../../js/kitchen/orderHistory.js"></script>
</body>
</html>